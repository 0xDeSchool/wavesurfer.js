"use strict";var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:50,pixelRatio:window.devicePixelRatio,fillParent:!0,scrollParent:!1,hideScrollbar:!1,normalize:!1,audioContext:null,container:null,dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,renderer:"Canvas",backend:"WebAudio"},init:function(e){if(this.params=WaveSurfer.util.extend({},this.defaultParams,e),this.container="string"==typeof e.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");this.savedVolume=0,this.isMuted=!1,this.createDrawer(),this.createBackend()},createDrawer:function(){var e=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){e.drawBuffer(),e.drawer.progress(e.backend.getPlayedPercents())}),this.on("progress",function(t){e.drawer.progress(t)}),this.drawer.on("click",function(t,i){setTimeout(function(){e.seekTo(i)},0)}),this.drawer.on("scroll",function(t){e.fireEvent("scroll",t)})},createBackend:function(){var e=this;this.backend&&this.backend.destroy(),this.backend=Object.create(WaveSurfer[this.params.backend]),this.backend.on("play",function(){e.fireEvent("play"),e.restartAnimationLoop()}),this.backend.on("finish",function(){e.fireEvent("finish")});try{this.backend.init(this.params)}catch(t){"Your browser doesn't support Web Audio"==t.message&&(this.params.backend="AudioElement",this.backend=null,this.createBackend())}},restartAnimationLoop:function(){var e=this,t=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=function(){e.backend.isPaused()||(e.fireEvent("progress",e.backend.getPlayedPercents()),t(i))};i()},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(e,t){this.backend.play(e,t)},pause:function(){this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},skipBackward:function(e){this.skip(e||-this.params.skipLength)},skipForward:function(e){this.skip(e||this.params.skipLength)},skip:function(e){var t=this.getCurrentTime()||0,i=this.getDuration()||1;t=Math.max(0,Math.min(i,t+(e||0))),this.seekTo(t/i)},seekAndCenter:function(e){this.seekTo(e),this.drawer.recenter(e)},seekTo:function(e){var t=this.backend.isPaused(),i=this.params.scrollParent;t&&(this.params.scrollParent=!1,this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0)),this.play(e*this.drawer.width/this.realPxPerSec),t&&(this.pause(),this.backend.setVolume(this.savedVolume)),this.params.scrollParent=i,this.fireEvent("seek",e)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(e){this.backend.setVolume(e)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},drawBuffer:function(){if(this.params.fillParent&&!this.params.scrollParent)var e=this.drawer.getWidth();else e=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio);this.realPxPerSec=e/this.getDuration(),this.drawer.drawPeaks(this.backend.getPeaks(e),e),this.fireEvent("redraw")},loadArrayBuffer:function(e){var t=this;this.backend.decodeArrayBuffer(e,function(e){t.loadDecodedBuffer(e)},function(){t.fireEvent("error","Error decoding audiobuffer")})},loadDecodedBuffer:function(e){this.empty(),this.backend.load(e),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(e){var t=this,i=new FileReader;i.addEventListener("progress",function(e){t.onProgress(e)}),i.addEventListener("load",function(e){t.empty(),t.loadArrayBuffer(e.target.result)}),i.addEventListener("error",function(){t.fireEvent("error","Error reading file")}),i.readAsArrayBuffer(e)},load:function(e,t){switch(this.params.backend){case"WebAudio":return this.loadBuffer(e);case"AudioElement":return this.loadAudioElement(e,t)}},loadBuffer:function(e){return this.empty(),this.downloadArrayBuffer(e,this.loadArrayBuffer.bind(this))},loadAudioElement:function(e,t){this.empty(),this.backend.load(e,t,this.container),this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(e){this.fireEvent("error",e)}.bind(this))},downloadArrayBuffer:function(e,t){var i=this,r=WaveSurfer.util.ajax({url:e,responseType:"arraybuffer"});return r.on("progress",function(e){i.onProgress(e)}),r.on("success",t),r.on("error",function(e){i.fireEvent("error","XHR error: "+e.target.statusText)}),r},onProgress:function(e){if(e.lengthComputable)var t=e.loaded/e.total;else t=e.loaded/(e.loaded+1e6);this.fireEvent("loading",Math.round(100*t),e.target)},empty:function(){this.drawFrame&&(this.un("progress",this.drawFrame),this.drawFrame=null),this.backend&&!this.backend.isPaused()&&(this.stop(),this.backend.disconnectSource()),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.unAll(),this.backend.destroy(),this.drawer.destroy()},enableInteraction:function(){this.params.interact=!0},disableInteraction:function(){this.params.interact=!1},toggleInteraction:function(){this.params.interact=!this.params.interact}};WaveSurfer.Observer={on:function(e,t){this.handlers||(this.handlers={});var i=this.handlers[e];i||(i=this.handlers[e]=[]),i.push(t)},un:function(e,t){if(this.handlers){var i=this.handlers[e];if(i)if(t)for(var r=i.length-1;r>=0;r--)i[r]==t&&i.splice(r,1);else i.length=0}},unAll:function(){this.handlers=null},once:function(e,t){var i=this,r=function(){t(),setTimeout(function(){i.un(e,r)},0)};this.on(e,r)},fireEvent:function(e){if(this.handlers){var t=this.handlers[e],i=Array.prototype.slice.call(arguments,1);t&&t.forEach(function(e){e.apply(null,i)})}}},WaveSurfer.util={extend:function(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){Object.keys(t).forEach(function(i){e[i]=t[i]})}),e},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},max:function(e,t){for(var i=-1/0,r=0,s=e.length;s>r;r++){var a=e[r];null!=t&&(a=Math.abs(a-t)),a>i&&(i=a)}return i},ajax:function(e){var t=Object.create(WaveSurfer.Observer),i=new XMLHttpRequest,r=!1;return i.open(e.method||"GET",e.url,!0),i.responseType=e.responseType,i.addEventListener("progress",function(e){t.fireEvent("progress",e),e.lengthComputable&&e.loaded==e.total&&(r=!0)}),i.addEventListener("load",function(e){r||t.fireEvent("progress",e),t.fireEvent("load",e),200==i.status||206==i.status?t.fireEvent("success",i.response,e):t.fireEvent("error",e)}),i.addEventListener("error",function(e){t.fireEvent("error",e)}),i.send(),t.xhr=i,t}},WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer),WaveSurfer.WebAudio={scriptBufferSize:256,fftSize:128,getAudioContext:function(){if(!window.AudioContext&&!window.webkitAudioContext)throw new Error("Your browser doesn't support Web Audio");return WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),WaveSurfer.WebAudio.audioContext},init:function(e){this.params=e,this.ac=e.audioContext||this.getAudioContext(),this.prevFrameTime=0,this.scheduledPause=null,this.firedFinish=!1,this.lastStartPosition=0,this.lastPlay=this.lastPause=this.nextPause=this.ac.currentTime,this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setPlaybackRate(this.params.audioRate)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(e){e&&e.disconnect()}),this.filters=null)},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(e){this.disconnectFilters(),e&&e.length?(this.filters=e,e.reduce(function(e,t){return e.connect(t),t},this.analyser).connect(this.gainNode)):this.analyser.connect(this.gainNode)},createScriptNode:function(){var e=this,t=this.scriptBufferSize;this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(t):this.ac.createJavaScriptNode(t),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){var t=e.getCurrentTime();!e.firedFinish&&e.buffer&&t>=e.getDuration()&&(e.firedFinish=!0,e.fireEvent("finish")),e.isPaused()||(e.onPlayFrame(t),e.fireEvent("audioprocess",t))}},onPlayFrame:function(e){null!=this.scheduledPause&&this.prevFrameTime>=this.scheduledPause&&this.pause(),this.prevFrameTime=e},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.fftSize=this.fftSize,this.analyserData=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(e){this.gainNode.gain.value=e},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(e,t,i){var r=this;this.ac.decodeAudioData(e,function(e){r.buffer=e,t(e)},i)},getPeaks:function(e){for(var t=this.buffer,i=t.length/e,r=~~(i/10)||1,s=t.numberOfChannels,a=new Float32Array(e),n=0;s>n;n++)for(var o=t.getChannelData(n),h=0;e>h;h++){for(var c=~~(h*i),u=~~(c+i),l=0,d=c;u>d;d+=r){var f=o[d];f>l?l=f:-f>l&&(l=-f)}(0==n||l>a[h])&&(a[h]=l)}return a},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},disconnectSource:function(){this.firedFinish=!1,this.source&&this.source.disconnect()},destroy:function(){this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect()},load:function(e){this.lastStartPosition=0,this.lastPlay=this.lastPause=this.nextPause=this.ac.currentTime,this.buffer=e,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.nextPause<=this.ac.currentTime},getDuration:function(){return this.buffer.duration},play:function(e,t){this.createSource(),null==e&&(e=this.getCurrentTime()),null==t&&(t=null!=this.scheduledPause?this.scheduledPause:this.getDuration()),this.lastPlay=this.ac.currentTime,this.lastStartPosition=e,this.lastPause=this.nextPause=this.ac.currentTime+(t-e),this.prevFrameTime=-1,this.source.start?this.source.start(0,e,t-e):this.source.noteGrainOn(0,e,t-e),this.fireEvent("play")},pause:function(){this.scheduledPause=null,this.lastPause=this.nextPause=this.ac.currentTime,this.source&&(this.source.stop?this.source.stop(0):this.source.noteOff(0)),this.fireEvent("pause")},getCurrentTime:function(){return this.isPaused()?this.lastStartPosition+(this.lastPause-this.lastPlay)*this.playbackRate:this.lastStartPosition+(this.ac.currentTime-this.lastPlay)*this.playbackRate},setPlaybackRate:function(e){this.playbackRate=e||1,this.source&&(this.source.playbackRate.value=this.playbackRate)}},WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer),WaveSurfer.AudioElement=Object.create(WaveSurfer.WebAudio),WaveSurfer.util.extend(WaveSurfer.AudioElement,{init:function(e){this.params=e,this.prevFrameTime=0,this.scheduledPause=null,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}};var t=this;this.on("audioprocess",function(e){e>t.maxCurrentTime&&(t.maxCurrentTime=e)})},load:function(e,t,i){var r=this,s=document.createElement("audio");s.controls=!1,s.autoplay=!1,s.src=e,s.addEventListener("error",function(){r.fireEvent("error","Error loading media element")}),s.addEventListener("canplay",function(){r.fireEvent("canplay")});var a=i.querySelector("audio");a&&i.removeChild(a),i.appendChild(s),this.media=s,this.peaks=t,this.maxCurrentTime=0,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return this.media.paused},getDuration:function(){return this.media.duration},getCurrentTime:function(){return this.media.currentTime},getPlayedPercents:function(){var e=this.getDuration(),t=this.getCurrentTime();return e>=1/0&&(e=this.maxCurrentTime),t/e||0},setPlaybackRate:function(e){this.playbackRate=e||1,this.media.playbackRate=this.playbackRate},play:function(e,t){null!=e&&(this.media.currentTime=e),this.scheduledPause=null==t?null:t,this.media.play(),this.fireEvent("play")},pause:function(){this.scheduledPause=null,this.media.pause(),this.fireEvent("pause")},getPeaks:function(){return this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(e){this.media.volume=e},destroy:function(){this.pause(),this.unAll(),this.media.parentNode.removeChild(this.media),this.media=null}}),WaveSurfer.Drawer={init:function(e,t){this.container=e,this.params=t,this.width=0,this.height=t.height*this.params.pixelRatio,this.lastPos=0,this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(e){e.preventDefault();var t=this.wrapper.getBoundingClientRect();return(e.clientX-t.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0},setupWrapperEvents:function(){var e=this;this.wrapper.addEventListener("click",function(t){var i=e.wrapper.offsetHeight-e.wrapper.clientHeight;if(0!=i){var r=e.wrapper.getBoundingClientRect();if(t.clientY>=r.bottom-i)return}e.params.interact&&e.fireEvent("click",t,e.handleEvent(t))})},drawPeaks:function(e,t){if(this.resetScroll(),this.setWidth(t),this.params.normalize)var i=WaveSurfer.util.max(e);else i=1;this.drawWave(e,i)},style:function(e,t){return Object.keys(t).forEach(function(i){e.style[i]!=t[i]&&(e.style[i]=t[i])}),e},resetScroll:function(){this.wrapper.scrollLeft=0},recenter:function(e){var t=this.wrapper.scrollWidth*e;this.recenterOnPosition(t,!0)},recenterOnPosition:function(e,t){var i=this.wrapper.scrollLeft,r=~~(this.wrapper.clientWidth/2),s=e-r,a=s-i,n=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=n){if(!t&&a>=-r&&r>a){var o=5;a=Math.max(-o,Math.min(o,a)),s=i+a}s=Math.max(0,Math.min(n,s)),s!=i&&(this.wrapper.scrollLeft=s)}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(e){e!=this.width&&(this.width=e,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateWidth())},progress:function(e){var t=1/this.params.pixelRatio,i=Math.round(e*this.width)*t;if(i<this.lastPos||i-this.lastPos>=t){if(this.lastPos=i,this.params.scrollParent){var r=~~(this.wrapper.scrollWidth*e);this.recenterOnPosition(r)}this.updateProgress(e)}},destroy:function(){this.unAll(),this.container.removeChild(this.wrapper),this.wrapper=null},createElements:function(){},updateWidth:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){}},WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer),WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){var e=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1}));this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,overflow:"hidden",width:"0",height:this.params.height+"px",borderRight:[this.params.cursorWidth+"px","solid",this.params.cursorColor].join(" ")}));var t=this.progressWave.appendChild(document.createElement("canvas")),i=0;this.params.selectionForeground&&(i=3);var r=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:i}));this.waveCc=e.getContext("2d"),this.progressCc=t.getContext("2d"),this.selectionCc=r.getContext("2d")},updateWidth:function(){var e=Math.round(this.width/this.params.pixelRatio);[this.waveCc,this.progressCc,this.selectionCc].forEach(function(t){t.canvas.width=this.width,t.canvas.height=this.height,this.style(t.canvas,{width:e+"px"})},this),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(e,t){var i=.5/this.params.pixelRatio;this.waveCc.fillStyle=this.params.waveColor,this.progressCc.fillStyle=this.params.progressColor;var r=this.height/2,s=r/t,a=1;this.params.fillParent&&this.width>e.length&&(a=this.width/e.length);var n=e.length;this.waveCc.beginPath(),this.waveCc.moveTo(i,r),this.progressCc.beginPath(),this.progressCc.moveTo(i,r);for(var o=0;n>o;o++){var h=Math.round(e[o]*s);this.waveCc.lineTo(o*a+i,r+h),this.progressCc.lineTo(o*a+i,r+h)}this.waveCc.lineTo(this.width+i,r),this.progressCc.lineTo(this.width+i,r),this.waveCc.moveTo(i,r),this.progressCc.moveTo(i,r);for(var o=0;n>o;o++){var h=Math.round(e[o]*s);this.waveCc.lineTo(o*a+i,r-h),this.progressCc.lineTo(o*a+i,r-h)}this.waveCc.lineTo(this.width+i,r),this.waveCc.fill(),this.progressCc.lineTo(this.width+i,r),this.progressCc.fill(),this.waveCc.fillRect(0,r-i,this.width,i)},updateProgress:function(e){var t=Math.round(this.width*e)/this.params.pixelRatio;this.style(this.progressWave,{width:t+"px"})}});
//# sourceMappingURL=/build/wavesurfer-js-map.json